{
  "gitSyncId": "690a1259f50d0b1fbf77939e_566ee499-e727-4fe5-96af-0c46a1c4cf9d",
  "unpublishedPage": {
    "actionCollections": [
      {
        "id": "OrderUtils",
        "name": "OrderUtils",
        "body": "export default {\n  // Inicializar lista de productos vacía\n  initProducts: async () => {\n    if (!appsmith.store.productsList) {\n      await storeValue('productsList', []);\n    }\n  },\n  \n  // Agregar una nueva fila de producto\n  addProduct: async () => {\n    const currentList = appsmith.store.productsList || [];\n    const newProduct = {\n      id: Date.now(),\n      producto: '',\n      cantidad: 1,\n      precioUnitario: 0,\n      subtotal: 0\n    };\n    await storeValue('productsList', [...currentList, newProduct]);\n  },\n  \n  // Eliminar producto por índice\n  removeProduct: async (index) => {\n    const currentList = appsmith.store.productsList || [];\n    const newList = currentList.filter((item, i) => i !== index);\n    await storeValue('productsList', newList);\n  },\n  \n  // Actualizar producto\n  updateProduct: async (index, field, value) => {\n    const currentList = appsmith.store.productsList || [];\n    const newList = [...currentList];\n    newList[index] = {...newList[index], [field]: value};\n    \n    // Calcular subtotal automáticamente\n    if (field === 'cantidad' || field === 'precioUnitario') {\n      newList[index].subtotal = (newList[index].cantidad || 0) * (newList[index].precioUnitario || 0);\n    }\n    \n    await storeValue('productsList', newList);\n  },\n  \n  // Calcular total del pedido\n  calculateTotal: () => {\n    const products = appsmith.store.productsList || [];\n    return products.reduce((sum, item) => sum + (item.subtotal || 0), 0);\n  },\n  \n  // Limpiar formulario completo\n  clearForm: async () => {\n    await storeValue('productsList', []);\n    await resetWidget('FormContainer', true);\n  },\n  \n  // Cancelar pedido\n  cancelOrder: async () => {\n    const confirmCancel = await showModal('ConfirmCancelModal');\n    if (confirmCancel) {\n      await OrderUtils.clearForm();\n      await showAlert('Pedido cancelado', 'info');\n    }\n  },\n  \n  // Guardar pedido\n  saveOrder: async () => {\n    const cliente = ContactSelect.selectedOptionLabel;\n    const numeroPedido = OrderNumberInput.text;\n    const fecha = OrderDatePicker.selectedDate;\n    const productos = appsmith.store.productsList || [];\n    const total = OrderUtils.calculateTotal();\n    \n    // Validaciones\n    if (!cliente) {\n      await showAlert('Por favor seleccione un cliente', 'error');\n      return;\n    }\n    \n    if (!numeroPedido) {\n      await showAlert('Por favor ingrese el número de pedido', 'error');\n      return;\n    }\n    \n    if (productos.length === 0) {\n      await showAlert('Debe agregar al menos un producto', 'error');\n      return;\n    }\n    \n    // Verificar que todos los productos estén completos\n    const productosIncompletos = productos.filter(p => !p.producto || p.cantidad <= 0 || p.precioUnitario <= 0);\n    if (productosIncompletos.length > 0) {\n      await showAlert('Todos los productos deben tener producto, cantidad y precio válidos', 'error');\n      return;\n    }\n    \n    // Aquí se guardaría en la base de datos\n    await showAlert(`Pedido ${numeroPedido} guardado exitosamente. Total: ${total.toFixed(2)} €`, 'success');\n    await OrderUtils.clearForm();\n  }\n}",
        "pluginType": "JS"
      }
    ],
    "layouts": [
      {
        "dsl": {
          "backgroundColor": "#F5F5F5",
          "bottomRow": 1000,
          "canExtend": true,
          "children": [
            {
              "type": "CONTAINER_WIDGET",
              "widgetId": "mainContainer",
              "widgetName": "FormContainer",
              "topRow": 4,
              "bottomRow": 94,
              "leftColumn": 4,
              "rightColumn": 60,
              "backgroundColor": "#FFFFFF",
              "borderRadius": "0.5rem",
              "boxShadow": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",
              "children": [
                {
                  "type": "TEXT_WIDGET",
                  "widgetId": "pageTitle",
                  "widgetName": "PageTitle",
                  "topRow": 2,
                  "bottomRow": 6,
                  "leftColumn": 2,
                  "rightColumn": 45,
                  "text": "Sistema de Gestión de Pedidos",
                  "fontSize": "1.875rem",
                  "fontStyle": "BOLD",
                  "textAlign": "LEFT",
                  "textColor": "#1F2937"
                },
                {
                  "type": "DIVIDER_WIDGET",
                  "widgetId": "mainDivider",
                  "widgetName": "MainDivider",
                  "topRow": 7,
                  "bottomRow": 8,
                  "leftColumn": 0,
                  "rightColumn": 64,
                  "orientation": "horizontal",
                  "strokeStyle": "solid",
                  "dividerColor": "#E5E7EB",
                  "thickness": 2
                },
                {
                  "type": "TEXT_WIDGET",
                  "widgetId": "clientSection",
                  "widgetName": "ClientSectionTitle",
                  "topRow": 10,
                  "bottomRow": 13,
                  "leftColumn": 2,
                  "rightColumn": 30,
                  "text": "Información del Cliente",
                  "fontSize": "1.25rem",
                  "fontStyle": "BOLD",
                  "textAlign": "LEFT",
                  "textColor": "#374151"
                },
                {
                  "type": "SELECT_WIDGET",
                  "widgetId": "clientSelect",
                  "widgetName": "ContactSelect",
                  "topRow": 14,
                  "bottomRow": 21,
                  "leftColumn": 2,
                  "rightColumn": 32,
                  "label": "Cliente *",
                  "labelTextSize": "1rem",
                  "placeholderText": "Buscar y seleccionar cliente...",
                  "isRequired": true,
                  "isFilterable": true,
                  "serverSideFiltering": false,
                  "options": [
                    { "label": "Juan Pérez (juan.perez@example.com)", "value": "client_001" },
                    { "label": "María García (maria.garcia@example.com)", "value": "client_002" },
                    { "label": "Carlos López (carlos.lopez@example.com)", "value": "client_003" },
                    { "label": "Ana Martínez (ana.martinez@example.com)", "value": "client_004" },
                    { "label": "Pedro Sánchez (pedro.sanchez@example.com)", "value": "client_005" }
                  ],
                  "defaultOptionValue": ""
                },
                {
                  "type": "BUTTON_WIDGET",
                  "widgetId": "newClientBtn",
                  "widgetName": "NewContactButton",
                  "topRow": 14,
                  "bottomRow": 21,
                  "leftColumn": 34,
                  "rightColumn": 50,
                  "text": "Nuevo Cliente",
                  "buttonStyle": "SECONDARY",
                  "buttonColor": "#3B82F6",
                  "onClick": "{{showModal('NewContactModal')}}",
                  "isVisible": true
                },
                {
                  "type": "DIVIDER_WIDGET",
                  "widgetId": "divider2",
                  "widgetName": "Divider2",
                  "topRow": 23,
                  "bottomRow": 24,
                  "leftColumn": 0,
                  "rightColumn": 64,
                  "orientation": "horizontal",
                  "strokeStyle": "dashed",
                  "dividerColor": "#D1D5DB"
                },
                {
                  "type": "TEXT_WIDGET",
                  "widgetId": "orderSection",
                  "widgetName": "OrderSectionTitle",
                  "topRow": 26,
                  "bottomRow": 29,
                  "leftColumn": 2,
                  "rightColumn": 30,
                  "text": "Detalles del Pedido",
                  "fontSize": "1.25rem",
                  "fontStyle": "BOLD",
                  "textAlign": "LEFT",
                  "textColor": "#374151"
                },
                {
                  "type": "INPUT_WIDGET_V2",
                  "widgetId": "orderNumInput",
                  "widgetName": "OrderNumberInput",
                  "topRow": 30,
                  "bottomRow": 37,
                  "leftColumn": 2,
                  "rightColumn": 20,
                  "label": "Número de Pedido *",
                  "labelTextSize": "1rem",
                  "inputType": "TEXT",
                  "placeholderText": "PED-XXXX",
                  "isRequired": true,
                  "defaultText": "{{`PED-${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,'0')}${String(new Date().getDate()).padStart(2,'0')}-${String(Date.now()).slice(-4)}`}}"
                },
                {
                  "type": "DATE_PICKER_WIDGET2",
                  "widgetId": "orderDate",
                  "widgetName": "OrderDatePicker",
                  "topRow": 30,
                  "bottomRow": 37,
                  "leftColumn": 21,
                  "rightColumn": 37,
                  "label": "Fecha *",
                  "labelTextSize": "1rem",
                  "dateFormat": "DD/MM/YYYY",
                  "isRequired": true,
                  "defaultDate": "{{moment().format('DD/MM/YYYY')}}"
                },
                {
                  "type": "SELECT_WIDGET",
                  "widgetId": "statusSelect",
                  "widgetName": "OrderStatusSelect",
                  "topRow": 30,
                  "bottomRow": 37,
                  "leftColumn": 38,
                  "rightColumn": 50,
                  "label": "Estado *",
                  "labelTextSize": "1rem",
                  "isRequired": true,
                  "options": [
                    { "label": "Pendiente", "value": "pending" },
                    { "label": "En Proceso", "value": "processing" },
                    { "label": "Completado", "value": "completed" },
                    { "label": "Cancelado", "value": "cancelled" }
                  ],
                  "defaultOptionValue": "pending"
                },
                {
                  "type": "INPUT_WIDGET_V2",
                  "widgetId": "notesInput",
                  "widgetName": "OrderNotesInput",
                  "topRow": 39,
                  "bottomRow": 46,
                  "leftColumn": 2,
                  "rightColumn": 50,
                  "label": "Observaciones / Notas",
                  "labelTextSize": "1rem",
                  "inputType": "TEXT",
                  "placeholderText": "Ingrese cualquier observación adicional sobre el pedido..."
                },
                {
                  "type": "DIVIDER_WIDGET",
                  "widgetId": "divider3",
                  "widgetName": "Divider3",
                  "topRow": 48,
                  "bottomRow": 49,
                  "leftColumn": 0,
                  "rightColumn": 64,
                  "orientation": "horizontal",
                  "strokeStyle": "dashed",
                  "dividerColor": "#D1D5DB"
                },
                {
                  "type": "TEXT_WIDGET",
                  "widgetId": "productsSection",
                  "widgetName": "ProductsSectionTitle",
                  "topRow": 51,
                  "bottomRow": 54,
                  "leftColumn": 2,
                  "rightColumn": 30,
                  "text": "Productos del Pedido",
                  "fontSize": "1.25rem",
                  "fontStyle": "BOLD",
                  "textAlign": "LEFT",
                  "textColor": "#374151"
                },
                {
                  "type": "BUTTON_WIDGET",
                  "widgetId": "addProductBtn",
                  "widgetName": "AddProductButton",
                  "topRow": 51,
                  "bottomRow": 54,
                  "leftColumn": 38,
                  "rightColumn": 50,
                  "text": "Agregar Producto",
                  "buttonStyle": "PRIMARY",
                  "buttonColor": "#10B981",
                  "onClick": "{{OrderUtils.addProduct()}}",
                  "isVisible": true
                },
                {
                  "type": "LIST_WIDGET_V2",
                  "widgetId": "productsList",
                  "widgetName": "ProductsList",
                  "topRow": 56,
                  "bottomRow": 75,
                  "leftColumn": 2,
                  "rightColumn": 50,
                  "listData": "{{appsmith.store.productsList || []}}",
                  "backgroundColor": "#FFFFFF",
                  "itemBackgroundColor": "#F9FAFB",
                  "itemSpacing": 8,
                  "children": [
                    {
                      "type": "CONTAINER_WIDGET",
                      "widgetId": "productItemContainer",
                      "widgetName": "ProductItemContainer",
                      "topRow": 0,
                      "bottomRow": 10,
                      "leftColumn": 0,
                      "rightColumn": 48,
                      "backgroundColor": "#F9FAFB",
                      "borderRadius": "0.375rem",
                      "boxShadow": "0 1px 2px 0 rgba(0, 0, 0, 0.05)",
                      "children": [
                        {
                          "type": "SELECT_WIDGET",
                          "widgetId": "productSelectItem",
                          "widgetName": "ProductSelect",
                          "topRow": 1,
                          "bottomRow": 5,
                          "leftColumn": 1,
                          "rightColumn": 20,
                          "label": "Producto",
                          "labelTextSize": "0.875rem",
                          "placeholderText": "Seleccionar...",
                          "isRequired": true,
                          "options": [
                            { "label": "Laptop Dell XPS 13 (899€)", "value": "laptop-dell-xps" },
                            { "label": "Mouse Logitech MX Master 3 (79€)", "value": "mouse-logitech" },
                            { "label": "Teclado Mecánico RGB (129€)", "value": "keyboard-mech" },
                            { "label": "Monitor LG UltraWide 29\" (299€)", "value": "monitor-lg" },
                            { "label": "Webcam Logitech C920 (89€)", "value": "webcam-logitech" },
                            { "label": "Auriculares Sony WH-1000XM4 (249€)", "value": "headphones-sony" },
                            { "label": "Tablet Samsung Galaxy Tab (349€)", "value": "tablet-samsung" },
                            { "label": "Impresora HP LaserJet (189€)", "value": "printer-hp" }
                          ],
                          "defaultOptionValue": "{{currentItem.producto}}"
                        },
                        {
                          "type": "INPUT_WIDGET_V2",
                          "widgetId": "quantityInput",
                          "widgetName": "QuantityInput",
                          "topRow": 1,
                          "bottomRow": 5,
                          "leftColumn": 21,
                          "rightColumn": 28,
                          "label": "Cantidad",
                          "labelTextSize": "0.875rem",
                          "inputType": "NUMBER",
                          "defaultText": "{{currentItem.cantidad || 1}}",
                          "placeholderText": "1",
                          "isRequired": true
                        },
                        {
                          "type": "INPUT_WIDGET_V2",
                          "widgetId": "priceInput",
                          "widgetName": "PriceInput",
                          "topRow": 1,
                          "bottomRow": 5,
                          "leftColumn": 29,
                          "rightColumn": 37,
                          "label": "Precio Unit. (€)",
                          "labelTextSize": "0.875rem",
                          "inputType": "NUMBER",
                          "defaultText": "{{currentItem.precioUnitario || 0}}",
                          "placeholderText": "0.00",
                          "isRequired": true
                        },
                        {
                          "type": "TEXT_WIDGET",
                          "widgetId": "subtotalText",
                          "widgetName": "SubtotalText",
                          "topRow": 1,
                          "bottomRow": 5,
                          "leftColumn": 38,
                          "rightColumn": 45,
                          "text": "{{((currentItem.cantidad || 0) * (currentItem.precioUnitario || 0)).toFixed(2)}} €",
                          "fontSize": "1.125rem",
                          "fontStyle": "BOLD",
                          "textAlign": "CENTER",
                          "textColor": "#059669"
                        },
                        {
                          "type": "ICON_BUTTON_WIDGET",
                          "widgetId": "deleteBtn",
                          "widgetName": "DeleteButton",
                          "topRow": 1,
                          "bottomRow": 5,
                          "leftColumn": 46,
                          "rightColumn": 48,
                          "iconName": "trash",
                          "buttonColor": "#EF4444",
                          "onClick": "{{OrderUtils.removeProduct(currentIndex)}}"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "TEXT_WIDGET",
                  "widgetId": "emptyMessage",
                  "widgetName": "EmptyMessage",
                  "topRow": 56,
                  "bottomRow": 62,
                  "leftColumn": 2,
                  "rightColumn": 50,
                  "text": "No hay productos agregados. Haga clic en 'Agregar Producto' para comenzar.",
                  "fontSize": "1rem",
                  "textAlign": "CENTER",
                  "textColor": "#6B7280",
                  "isVisible": "{{(appsmith.store.productsList || []).length === 0}}"
                },
                {
                  "type": "CONTAINER_WIDGET",
                  "widgetId": "totalContainer",
                  "widgetName": "TotalContainer",
                  "topRow": 77,
                  "bottomRow": 82,
                  "leftColumn": 28,
                  "rightColumn": 50,
                  "backgroundColor": "#DBEAFE",
                  "borderRadius": "0.5rem",
                  "boxShadow": "0 1px 3px 0 rgba(0, 0, 0, 0.1)",
                  "children": [
                    {
                      "type": "TEXT_WIDGET",
                      "widgetId": "totalLabel",
                      "widgetName": "TotalLabel",
                      "topRow": 1,
                      "bottomRow": 4,
                      "leftColumn": 2,
                      "rightColumn": 10,
                      "text": "TOTAL:",
                      "fontSize": "1.5rem",
                      "fontStyle": "BOLD",
                      "textAlign": "RIGHT",
                      "textColor": "#1E40AF"
                    },
                    {
                      "type": "TEXT_WIDGET",
                      "widgetId": "totalAmount",
                      "widgetName": "TotalAmount",
                      "topRow": 1,
                      "bottomRow": 4,
                      "leftColumn": 11,
                      "rightColumn": 20,
                      "text": "{{((appsmith.store.productsList || []).reduce((sum, item) => sum + ((item.cantidad || 0) * (item.precioUnitario || 0)), 0)).toFixed(2)}} €",
                      "fontSize": "1.5rem",
                      "fontStyle": "BOLD",
                      "textAlign": "LEFT",
                      "textColor": "#059669"
                    }
                  ]
                },
                {
                  "type": "BUTTON_WIDGET",
                  "widgetId": "cancelBtn",
                  "widgetName": "CancelButton",
                  "topRow": 85,
                  "bottomRow": 90,
                  "leftColumn": 2,
                  "rightColumn": 15,
                  "text": "Cancelar",
                  "buttonStyle": "SECONDARY",
                  "buttonColor": "#6B7280",
                  "onClick": "{{OrderUtils.cancelOrder()}}",
                  "isVisible": true
                },
                {
                  "type": "BUTTON_WIDGET",
                  "widgetId": "clearBtn",
                  "widgetName": "ClearButton",
                  "topRow": 85,
                  "bottomRow": 90,
                  "leftColumn": 17,
                  "rightColumn": 30,
                  "text": "Limpiar Todo",
                  "buttonStyle": "SECONDARY",
                  "buttonColor": "#F59E0B",
                  "onClick": "{{OrderUtils.clearForm()}}",
                  "isVisible": true
                },
                {
                  "type": "BUTTON_WIDGET",
                  "widgetId": "saveBtn",
                  "widgetName": "SaveOrderButton",
                  "topRow": 85,
                  "bottomRow": 90,
                  "leftColumn": 35,
                  "rightColumn": 50,
                  "text": "Guardar Pedido",
                  "buttonStyle": "PRIMARY",
                  "buttonColor": "#10B981",
                  "onClick": "{{OrderUtils.saveOrder()}}",
                  "isVisible": true,
                  "isDisabled": "{{!ContactSelect.selectedOptionValue || !OrderNumberInput.text || !OrderDatePicker.selectedDate || (appsmith.store.productsList || []).length === 0}}"
                }
              ]
            },
            {
              "type": "MODAL_WIDGET",
              "widgetId": "newContactModal",
              "widgetName": "NewContactModal",
              "topRow": 20,
              "bottomRow": 60,
              "leftColumn": 20,
              "rightColumn": 44,
              "isVisible": false,
              "children": [
                {
                  "type": "TEXT_WIDGET",
                  "widgetId": "modalTitle",
                  "widgetName": "ModalTitle",
                  "topRow": 1,
                  "bottomRow": 5,
                  "leftColumn": 1,
                  "rightColumn": 23,
                  "text": "Nuevo Cliente",
                  "fontSize": "1.5rem",
                  "fontStyle": "BOLD",
                  "textColor": "#1F2937"
                },
                {
                  "type": "INPUT_WIDGET_V2",
                  "widgetId": "nameInput",
                  "widgetName": "ContactNameInput",
                  "topRow": 7,
                  "bottomRow": 14,
                  "leftColumn": 1,
                  "rightColumn": 23,
                  "label": "Nombre Completo *",
                  "labelTextSize": "1rem",
                  "inputType": "TEXT",
                  "placeholderText": "Ej: Juan Pérez González",
                  "isRequired": true
                },
                {
                  "type": "INPUT_WIDGET_V2",
                  "widgetId": "emailInput",
                  "widgetName": "ContactEmailInput",
                  "topRow": 15,
                  "bottomRow": 22,
                  "leftColumn": 1,
                  "rightColumn": 23,
                  "label": "Correo Electrónico *",
                  "labelTextSize": "1rem",
                  "inputType": "EMAIL",
                  "placeholderText": "ejemplo@correo.com",
                  "isRequired": true
                },
                {
                  "type": "INPUT_WIDGET_V2",
                  "widgetId": "phoneInput",
                  "widgetName": "ContactPhoneInput",
                  "topRow": 23,
                  "bottomRow": 30,
                  "leftColumn": 1,
                  "rightColumn": 23,
                  "label": "Teléfono",
                  "labelTextSize": "1rem",
                  "inputType": "PHONE_NUMBER",
                  "placeholderText": "+34 600 000 000"
                },
                {
                  "type": "INPUT_WIDGET_V2",
                  "widgetId": "addressInput",
                  "widgetName": "ContactAddressInput",
                  "topRow": 31,
                  "bottomRow": 38,
                  "leftColumn": 1,
                  "rightColumn": 23,
                  "label": "Dirección Completa",
                  "labelTextSize": "1rem",
                  "inputType": "TEXT",
                  "placeholderText": "Calle, número, código postal, ciudad..."
                },
                {
                  "type": "BUTTON_WIDGET",
                  "widgetId": "modalCancelBtn",
                  "widgetName": "ModalCancelButton",
                  "topRow": 40,
                  "bottomRow": 45,
                  "leftColumn": 1,
                  "rightColumn": 10,
                  "text": "Cancelar",
                  "buttonStyle": "SECONDARY",
                  "buttonColor": "#6B7280",
                  "onClick": "{{closeModal('NewContactModal')}}"
                },
                {
                  "type": "BUTTON_WIDGET",
                  "widgetId": "modalSaveBtn",
                  "widgetName": "ModalSaveButton",
                  "topRow": 40,
                  "bottomRow": 45,
                  "leftColumn": 12,
                  "rightColumn": 23,
                  "text": "Guardar Cliente",
                  "buttonStyle": "PRIMARY",
                  "buttonColor": "#10B981",
                  "onClick": "{{showAlert('Cliente \"' + ContactNameInput.text + '\" guardado exitosamente', 'success'); closeModal('NewContactModal')}}",
                  "isDisabled": "{{!ContactNameInput.text || !ContactEmailInput.text}}"
                }
              ]
            }
          ],
          "containerStyle": "none",
          "detachFromLayout": true,
          "dynamicBindingPathList": [],
          "dynamicTriggerPathList": [],
          "leftColumn": 0,
          "minHeight": 1292,
          "parentColumnSpace": 1,
          "parentRowSpace": 1,
          "rightColumn": 4896,
          "snapColumns": 64,
          "snapRows": 124,
          "topRow": 0,
          "type": "CANVAS_WIDGET",
          "version": 94,
          "widgetId": "0",
          "widgetName": "MainContainer"
        }
      }
    ],
    "name": "Page1",
    "slug": "page1"
  }
}
